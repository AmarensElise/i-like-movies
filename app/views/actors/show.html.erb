<%# app/views/actors/show.html.erb %>
<div class="max-w-6xl mx-auto p-6">
  <!-- Back Link -->
  <div class="mb-6">
    <%= link_to :back, class: "inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back
    <% end %>
  </div>

      <div class="my-4 flex justify-end">
          <%= button_to favorite_actors_path(actor_id: @actor.id),
            method: :post,
            form_class: "inline",
            data: { turbo: false },
            class: "inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition
                    #{@actor.favorited? ? 'bg-yellow-100 text-yellow-700 cursor-default' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'}",
            disabled: @actor.favorited?,
            title: @actor.favorited? ? 'Favorited' : 'Add to favorites' do %>

            <% if @actor.favorited? %>
              <!-- filled star -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
                <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clip-rule="evenodd" />
              </svg>
              <span>Favorited</span>
            <% else %>
              <!-- outline star -->
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
              </svg>
              <span>Favorite</span>
            <% end %>
          <% end %>
        </div>

  <!-- Actor Details -->
  <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
    <div class="md:flex">
      <!-- Actor Image -->
      <div class="md:w-1/3 lg:w-1/4 p-6 flex justify-center items-start">
        <% profile_path = @actor_details&.dig('profile_path') %>
        <% if profile_path.present? %>
          <img src="https://image.tmdb.org/t/p/w300<%= profile_path %>" alt="<%= @actor.name %>" class="w-48 h-48 rounded-full object-cover border-4 border-gray-200 shadow-lg" />
        <% else %>
          <div class="w-48 h-48 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 border-4 border-gray-200 shadow-lg">
            <span class="text-gray-500">No Image</span>
          </div>
        <% end %>
      </div>

      <!-- Actor Info -->
      <div class="p-6 md:w-2/3 lg:w-3/4">
        <h1 class="text-4xl font-bold text-gray-900 mb-2"><%= @actor.name %></h1>

   

        <div class="mb-3">
            <% if @actor.birthday.present? %>
              <% current_age = Date.today.year - @actor.birthday.year - ((Date.today.month > @actor.birthday.month || (Date.today.month == @actor.birthday.month && Date.today.day >= @actor.birthday.day)) ? 0 : 1) %>
              <span class="text-gray-600 flex items-center flex-wrap">
                <span>Born <%= @actor.birthday.strftime('%B %d, %Y') %> (Age: <%= current_age %>)</span>
                <% if @actor_details&.dig('place_of_birth').present? %>
                  <span class="mx-2">•</span>
                  <span><%= @actor_details['place_of_birth'] %></span>
                <% end %>
              </span>
            <% end %>
          </div>

        <!-- Additional actor info from TMDB -->
        <div class="mb-6">
          <h3 class="text-lg font-medium text-gray-800 mb-2">Biography</h3>

          <% biography = @actor_details&.dig('biography') %>

          <% if biography.present? %>
            <details class="group">
              <summary class="cursor-pointer text-gray-700 line-clamp-4">
                <%= biography %>
              </summary>

              <div class="mt-2 text-gray-700">
                <%= biography %>
              </div>

              <span class="mt-2 inline-block text-sm text-indigo-600 group-open:hidden">
                Read more
              </span>

              <span class="mt-2 hidden text-sm text-indigo-600 group-open:inline-block">
                Read less
              </span>
            </details>
          <% else %>
            <p class="text-gray-700">No biography available</p>
          <% end %>
        </div>


      </div>
    </div>
  </div>

  <!-- Filmography Section -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold text-gray-900 mb-4">Filmography</h2>

    <% if @roles.present? %>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="divide-y">
          <% @roles.each do |role| %>
            <%= link_to movie_path(role.movie), class: "block hover:bg-gray-50" do %>
              <div class="p-4 flex items-center">
                <% if role.movie.poster_path.present? %>
                  <img src="https://image.tmdb.org/t/p/w92<%= role.movie.poster_path %>" alt="<%= role.movie.title %>" class="w-12 h-18 object-cover rounded mr-4" />
                <% else %>
                  <div class="w-12 h-18 bg-gray-200 flex items-center justify-center rounded mr-4">
                    <span class="text-gray-500 text-xs">No Image</span>
                  </div>
                <% end %>

                <div>
                  <h4 class="font-medium text-gray-900"><%= role.movie.title %></h4>
                  <div class="flex items-center text-sm">
                    <span class="text-gray-500"><%= role.movie.release_date&.year || "Unknown" %></span>
                    <span class="mx-2 text-gray-400">•</span>
                    <span class="text-gray-500">as <%= role.character %></span>
                    <% if role.age_during_filming.present? %>
                      <span class="mx-2 text-gray-400">•</span>
                      <span class="text-gray-500">Age: <%= role.age_during_filming %></span>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="bg-gray-100 rounded-lg p-4 text-center">
        <p class="text-gray-600">No filmography information available</p>
      </div>
    <% end %>
  </div>
</div>
