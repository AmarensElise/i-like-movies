<div class="flex gap-3 items-center justify-end">
  <% unless movie.on_watchlist? %>
    <button
      type="button"
      data-action="click->modal#open"
      class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm font-medium transition bg-gray-100 hover:bg-gray-200 text-gray-700"
      title="Add to watchlist">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
        <path fill-rule="evenodd" d="M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
      </svg>

      <span>Watchlist</span>
    </button>
  <% else %>
    <span class="inline-flex items-center gap-2 rounded-full bg-blue-100 px-3 py-2 text-sm font-medium text-blue-700 cursor-default">
      On watchlist
    </span>
  <% end %>

  <% if movie.seen? %>
    <!-- watched (filled eye) -->
    <span class="inline-flex items-center gap-2 rounded-full bg-green-100 px-3 py-2 text-sm font-medium text-green-700" title="Watched">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
      </svg>
    </span>
  <% else %>
    <%= button_to viewings_path(movie_id: movie.id),
      method: :post,
      data: { turbo: false },
      form_class: "inline",
      class: "inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-200",
      title: "Mark as watched" do %>

      <!-- eye outline -->
      <span class="group">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 text-gray-600 group-hover:text-black">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
      </span>
    <% end %>
  <% end %>
</div>

<% unless movie.on_watchlist? %>
  <div
    id="watchlist-modal-<%= movie.id %>"
    data-controller="modal"
    data-action="click->modal#close"
    class="fixed inset-0 z-50 hidden bg-black/40 flex items-center justify-center">
    
    <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-lg">
      <h3 class="text-lg font-semibold mb-4">
        Why do you want to watch this?
      </h3>

      <%= form_with url: watchlist_items_path, method: :post, data: { turbo: false } do |f| %>
        <%= f.hidden_field :movie_id, value: movie.id %>

        <%= f.text_area :pitch,
              rows: 4,
              placeholder: "e.g. Recommended by someone, sounds cozy, great castâ€¦",
              class: "w-full rounded-lg border-gray-300 focus:border-gray-500 focus:ring-gray-500 mb-4" %>

        <div class="flex justify-end gap-3">
          <button type="button"
                  data-modal-close
                  class="text-sm text-gray-600 hover:text-black">
            Cancel
          </button>

          <%= f.submit "Add to watchlist",
                class: "rounded-full bg-black px-4 py-2 text-sm font-medium text-white hover:bg-gray-800" %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>