<div data-controller="toggle">
  <button
    type="button"
    data-action="toggle#toggle"
    data-toggle-target="button"
    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm font-medium transition bg-purple-100 hover:bg-purple-200 text-purple-700 cursor-pointer"
    title="Add to list">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
    </svg>
    <span data-toggle-target="label">Add to List</span>
  </button>

  <div data-toggle-target="panel" class="hidden absolute z-10 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 p-3 right-0">
    <% if current_user.lists.any? %>
      <h3 class="font-semibold text-gray-900 mb-2 text-sm">Quick add to:</h3>
      <div class="space-y-1 max-h-48 overflow-y-auto">
        <% current_user.lists.order(name: :asc).limit(5).each do |list| %>
          <% movie_in_list = list.list_items.exists?(movie_id: movie.id) %>
          <% if movie_in_list %>
            <div class="flex items-center gap-2 px-2 py-1 text-xs text-green-700 bg-green-50 rounded">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-4 w-4">
                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
              </svg>
              <%= list.name %>
            </div>
          <% else %>
            <%= button_to list_items_path(list_id: list.id, movie_id: movie.id), method: :post, data: { turbo: false }, class: "w-full text-left px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 rounded block" do %>
              <%= list.name %>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div class="mt-2 pt-2 border-t border-gray-200">
        <%= link_to "Manage All Lists", lists_path, class: "text-xs text-blue-600 hover:text-blue-800" %>
      </div>
    <% else %>
      <p class="text-xs text-gray-600 mb-2">No lists yet</p>
      <%= link_to "Create List", new_list_path, class: "text-xs text-blue-600 hover:text-blue-800" %>
    <% end %>
  </div>
</div>
